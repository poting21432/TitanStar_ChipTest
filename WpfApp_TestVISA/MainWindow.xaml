<Window x:Class="WpfApp_TestVISA.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:WpfApp_TestVISA" 
        xmlns:wpf="clr-namespace:Support.Wpf;assembly=Support" 
        mc:Ignorable="d" Background="{StaticResource SCB_ChartBackground_Medium}"
        Title="立捷頻譜儀 讀寫測試工具" FontSize="25" Loaded="Window_Loaded" Height="1050"
        Width="1900" WindowStartupLocation="CenterScreen" WindowState="Maximized">
    <Window.DataContext>
        <local:Model_Main/>
    </Window.DataContext>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary x:Name="Resource_BlueEx" Source="/WpfApp.Themes.BlueEX;component/BlueEx/Pack.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>
    <StackPanel Orientation="Horizontal">
        <StackPanel Margin="10">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="VISA裝置" Width="120"/>
                <ComboBox ItemsSource="{Binding VISA_Devices}" FontSize="25" Width="410" Margin="10 0"/>
                <Button Content="刷新" IsEnabled="{Binding EnConnect}" Command="{Binding Command_Connect}" Width="100" FontSize="25"/>
                <Button Content="{Binding TextConnect}" IsEnabled="{Binding EnConnect}" Command="{Binding Command_Connect}" Width="100" Margin="10 0" FontSize="25"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0 10">
                <TextBlock Text="寫入數據" Width="120"/>
                <TextBox Text="{Binding WriteData}" Width="520" Margin="10 0"/>
                <Button Content="寫入" Width="100" FontSize="25" Command="{Binding Command_Write}"/>
            </StackPanel>
            <wpf:UserControl_Log Height="400" Margin="0 10" Width="920"/>
            <DataGrid Margin="0 20" AutoGenerateColumns="False" Width="920" FontSize="20" Style="{StaticResource StyleDataGrid_RowSelection}"
                IsReadOnly="True" ItemsSource="{Binding ProductRecords}" Height="440" CanUserSortColumns="True" CanUserAddRows="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" FontSize="20" Binding="{Binding ID}" Width="50"/>
                    <DataGridTextColumn Header="開始時間" FontSize="20" Binding="{Binding TimeStart}" Width="140"/>
                    <DataGridTextColumn Header="結束時間" FontSize="20" Binding="{Binding TimeEnd}" Width="140"/>
                    <DataGridTextColumn Header="燒錄" FontSize="20" Binding="{Binding BurnCheck}"  Width="40"/>
                    <DataGridTextColumn Header="3V-uA" FontSize="20" Binding="{Binding Test3VuA, StringFormat=F3}"  Width="70"/>
                    <DataGridTextColumn Header="導通" FontSize="20" Binding="{Binding OnCheck}"  Width="45"/>
                    <DataGridTextColumn Header="DIO" FontSize="20" Binding="{Binding DIOCheck}"  Width="45"/>
                    <DataGridTextColumn Header="指撥1" FontSize="20" Binding="{Binding Switch1Check}"  Width="45"/>
                    <DataGridTextColumn Header="指撥2" FontSize="20" Binding="{Binding Switch2Check}"  Width="45"/>
                    <DataGridTextColumn Header="蓋開" FontSize="20" Binding="{Binding CoverCheck}"  Width="45"/>
                    <DataGridTextColumn Header="5V-mA" FontSize="20" Binding="{Binding Test5VmA, StringFormat=F3}"  Width="70"/>
                    <DataGridTextColumn Header="磁簧" FontSize="20" Binding="{Binding ReedCheck}"  Width="45"/>
                    <DataGridTextColumn Header="2.4V" FontSize="20" Binding="{Binding LowVCheck}"  Width="55"/>
                    <DataGridTextColumn Header="開關" FontSize="20" Binding="{Binding OnOffCheck}"  Width="55"/>
                    <DataGridTextColumn Header="頻譜儀" FontSize="20" Binding="{Binding TestAntenna, StringFormat=F1}"  Width="70"/>
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>
        <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0 10">
                <TextBlock Text="產品別" Margin="15 0"/>
                <ComboBox ItemsSource="{Binding ProductTypes}" SelectedValue="{Binding SelectedProductType}" Width="200" Margin="20 0"/>
                <TextBlock Text="手動" Margin="15 0"/>
                <CheckBox IsChecked="{Binding IsManualMode}" Margin="0 10">
                    <CheckBox.LayoutTransform>
                        <ScaleTransform ScaleX="1.2" ScaleY="1.2"/>
                    </CheckBox.LayoutTransform>
                </CheckBox>
            </StackPanel>
            <StackPanel Orientation="Horizontal">
                <Button Content="測試流程開始" Width="200" Margin="10" FontSize="30" Height="45" Command="{Binding Commnad_MainSequence}"/>
                <Button Content="測試復歸" Width="200" Margin="20 0" FontSize="30" Height="45" Command="{Binding Commnad_MainReset}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal">
                <Button Content="燒錄流程開始" Width="200" Margin="10" FontSize="30" Height="45" Command="{Binding Commnad_BurnSequence}"/>
                <Button Content="燒錄復歸" Width="200" Margin="20 0" FontSize="30" Height="45" Command="{Binding Commnad_MainReset}"/>
            </StackPanel>
            <StackPanel Orientation="Horizontal">
                <Button Content="步進" Width="200" Margin="10 10" FontSize="30" Height="45" Command="{Binding Commnad_NextStepBurn}"/>
                <CheckBox Content="步進模式" IsChecked="{Binding IsModeStep}" Margin="10 0"/>
            </StackPanel>
            
            <StackPanel Visibility="Collapsed" Orientation="Horizontal" Margin="10">
                <Button Content="跳過目前步驟" FontSize="30" Width="240" Height="50"/>
                <Button Content="取消生產" FontSize="30" Width="240" Height="50" Margin="10 0"/>
            </StackPanel>
            <StackPanel Visibility="Collapsed">
                <TextBlock Text="左側選擇產品指定測試項目" FontSize="35" Margin="10 0"/>
                <StackPanel Orientation="Horizontal" Margin="10">
                    <ComboBox ItemsSource="{Binding AssignedTests}" SelectedItem="{Binding AssignedTest}"
               Width="320" Margin="10 0"/>
                    <Button Content="開始測試" Height="40" Width="150"/>
                </StackPanel>
            </StackPanel>
           
            <GroupBox Header="作業流程" Width="500"
                FontSize="35" Margin="5 10"  Grid.Column="0">
                <ItemsControl ItemsSource="{Binding StepsData}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type wpf:StepData}">
                            <StackPanel Orientation="Horizontal" Height="45" VerticalAlignment="Center">
                                <wpf:UserControl_StatusIndicator FontSize="20" Width="25" Height="25" Status="{Binding DataContext.Status, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ContentPresenter}}"
                        VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                <TextBlock Text="{Binding Title}" FontSize="30" Foreground="{Binding ColorBrush}" Margin="5" Width="300"/>
                                <TextBlock Text="{Binding TimeTag}" FontSize="25" VerticalAlignment="Center" Width="90" Foreground="{Binding ColorBrush}" Margin="5"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </GroupBox>
        </StackPanel>
        <StackPanel>
            <StackPanel Orientation="Horizontal">
                <StackPanel Margin="10">
                    <TextBlock Text="電表測試" FontSize="40"/>
                    <Button Width="200" Content="切電表為低量程" Height="50" Margin="0 10" Command="{Binding Command_SetPowerMeter_Low}"/>
                    <Button Width="200" Content="電表低量程量測" Height="50" Command="{Binding Command_TestPowerMeter_Low}"/>
                    <Button Width="200" Content="切電表為高量程" Height="50" Margin="0 10" Command="{Binding Command_SetPowerMeter_High}"/>
                    <Button Width="200" Content="電表高量程量測" Height="50" Command="{Binding  Command_TestPowerMeter_High}"/>
                    <Button Width="200" Content="G51 3V電壓On" Height="50" Command="{Binding  Command_Test1}"/>
                    <Button Width="200" Content="G51 3V電壓Off" Height="50" Command="{Binding  Command_Test2}"/>
                </StackPanel>
                <StackPanel VerticalAlignment="Top">
                    <TextBlock Text="手動燒錄" FontSize="40" Margin="0 10"/>
                    <ComboBox ItemsSource="{Binding BurnTypes}" SelectedValue="{Binding SelectedBurnType}"/>
                    <Button Width="200" Content="燒錄" Height="50" Margin="0 10" Command="{Binding Command_TestBurn}"/>
                    <Button Width="200" Content="光敏測試" Height="50" Margin="0 10" Command="{Binding Command_PhotoresistTest}"/>

                    <Button Width="200" Content="G51 3V探針On" Height="50" Command="{Binding  Command_Test3}"/>
                    <Button Width="200" Content="G51 3V探針Off" Height="50" Command="{Binding  Command_Test4}"/>
                </StackPanel>
            </StackPanel>
            <DataGrid Margin="0 20" AutoGenerateColumns="False" FontSize="30" Style="{StaticResource StyleDataGrid_RowSelection}"
                    IsReadOnly="True" ItemsSource="{Binding PLCAddrData}" Height="660" CanUserSortColumns="True" CanUserAddRows="False"
                      SelectedItem="{Binding SelectedPLCAddr}" >
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" FontSize="20" Binding="{Binding Id}" Width="50"/>
                    <DataGridTextColumn Header="名稱" FontSize="20" Binding="{Binding Title}" Width="210"/>
                    <DataGridTextColumn Header="位置" FontSize="20" Binding="{Binding Address}" Width="65"/>
                    <DataGridTextColumn Header="狀態" FontSize="20" Binding="{Binding Status}" Width="35">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Status}" Value="1">
                                        <Setter Property="Foreground" Value="LightGreen"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Status}" Value="0">
                                        <Setter Property="Foreground" Value="LightBlue"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn Header="設定" >
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Button Content="ON" Width="40" Margin="0 0 5 0" 
                                            Command="{x:Static local:PLCData.CommandSetTrue}"
                                            CommandParameter="{Binding}" />
                                    <Button Content="OFF" Width="40" 
                                            Command="{x:Static local:PLCData.CommandSetFalse}"
                                            CommandParameter="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>
        
       
    </StackPanel>
   
</Window>
